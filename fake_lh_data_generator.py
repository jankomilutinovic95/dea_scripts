import os
import random
from datetime import datetime, timedelta
from typing import Union, Any
from enum import Enum

import pytz
from dotenv import load_dotenv

from utils.db_connection import execute_query, params
from utils.wl_invoice_queries import queries


load_dotenv()

today: datetime = datetime.now(tz=pytz.timezone('US/Central')).replace(hour=0, minute=0, second=0, microsecond=0)
prev_day = today - timedelta(days=1)
vehicle_ids: list[str] = ["1202", "1203", "6252", "6253", "285902", "2447057", "2447058", "2447059", "2447060",
                          "2447061", "2447062", "2447063", "2447064", "2447065", "2447066", "2447067", "2447068",
                          "2447069", "2447070", "2447071", "2554452", "2554453", "2554454", "2554455", "2554456",
                          "2554457", "2710306", "2710307", "2710310", "2879118", "3118454", "3309402", "3309403",
                          "6254", "6255", "6256", "6257", "6258", "6259", "6260", "6261", "6262", "6263", "6264",
                          "6265", "6266", "6267", "6268", "6269", "6270", "6271", "9502", "1340104", "2710302",
                          "2879104", "2879105", "2879106", "2879107", "2879108", "2879109", "2879110", "2879111",
                          "2879112", "2879113", "2879114", "2879115", "2879116", "2879117", "3244053", "9503", "9504",
                          "9505", "9506", "9507", "9508", "9509", "40352", "40355", "40356", "40357", "40358", "40359",
                          "40360", "40362", "93152", "222513", "285906", "900354", "974852", "1016153", "1378353",
                          "1378354", "1480305", "1480308", "1828752", "1828753", "1859053", "2447053", "28952", "28953",
                          "28954", "28955", "28956", "28957", "28958", "28959", "28960", "28961", "28962", "28963",
                          "28964", "28965", "28966", "28967", "28968", "28969", "28970", "28971", "28972", "28973",
                          "28974", "28975", "28976", "28977", "28978", "28979", "28980", "28981", "28982", "28983",
                          "28984", "28985", "28986", "28987", "28988", "28989", "28990", "28991", "28992", "28993",
                          "30768", "40353", "40354", "40361", "40364", "108552", "108553", "184002", "285905", "285907",
                          "404257", "404258", "404259", "667752", "747702", "900353", "1123008", "1310902", "1340103",
                          "1340105", "1340106", "1378355", "1436253", "1480309", "1480312", "1480313", "1747203",
                          "1747205", "1828755", "1853652", "1936912", "1936913", "2133553", "2238966", "2374902",
                          "28994", "28995", "28996", "28997", "28998", "28999", "29000", "29001", "29552", "29553",
                          "29554", "29555", "29556", "29557", "29558", "29559", "29560", "29561", "543352", "543353",
                          "543354", "543355", "543356", "543357", "543358", "543359", "1859054", "1859055", "1859056",
                          "1936914", "2447052", "2447055", "2879127", "3118452", "3118453", "29562", "29563", "29564",
                          "29565", "29566", "29567", "29568", "29569", "29570", "29571", "1016154", "1016155",
                          "2447054", "29572", "29573", "29574", "29575", "29576", "29577", "29578", "29579", "29580",
                          "29581", "29582", "29583", "29584", "29585", "851753", "851754", "851755", "2133554",
                          "2133555", "2710309", "3183458", "3183459", "29586", "29587", "29588", "29589", "29590",
                          "29591", "29592", "29593", "29594", "29595", "29596", "29597", "29598", "29599", "29600",
                          "29601", "30252", "30253", "1936902", "2133552", "2238952", "2238953", "2238954", "2238955",
                          "30254", "30255", "30256", "1480306", "1480307", "1604352", "1604353", "1604354", "1604355",
                          "2821454", "2821458", "3183453", "3183454", "3183455", "3183456", "3183457", "30257", "30258",
                          "30259", "30260", "30261", "30262", "30263", "30264", "30265", "30266", "30267", "30268",
                          "30269", "30270", "30271", "30272", "30273", "30274", "30275", "30276", "30277", "30278",
                          "30279", "30280", "30281", "30282", "30283", "30284", "30285", "30286", "30287", "30288",
                          "30289", "30290", "30291", "30292", "30293", "30294", "30295", "30296", "30297", "30298",
                          "30299", "30300", "30301", "30752", "30753", "30754", "30755", "30756", "30757", "30758",
                          "30759", "30760", "30761", "30762", "30763", "30764", "30765", "30766", "30767", "40363",
                          "285904", "285908", "285909", "285910", "285911", "285912", "285913", "285914", "285915",
                          "404252", "404253", "404260", "404261", "404262", "404263", "404264", "667753", "667754",
                          "696854", "696857", "1016152", "1123002", "1123003", "1123004", "1123005", "1123006",
                          "1340102", "1480310", "1480311", "1828754", "1853653", "1859052", "1936903", "1936904",
                          "1936906", "1936907", "1936908", "1936909", "1936910", "1936911", "2238956", "2238957",
                          "2238958", "2238959", "2238960", "2238961", "2238962", "2238963", "2238964", "2238965",
                          "2617604", "2710308", "2710311", "2710312", "2710314", "2821457", "3309405", "30769", "30770",
                          "30771", "30772", "30773", "30774", "30775", "30776", "30777", "30778", "222503", "222504",
                          "222505", "222506", "222507", "222508", "222509", "222510", "222511", "222512", "222514",
                          "285903", "285916", "404254", "404255", "404256", "696852", "696853", "696856", "747703",
                          "851752", "900352", "1016156", "1378352", "1436252", "1604356", "1747202", "1747204",
                          "2447056", "2554458", "2710315", "3055561", "3183460", "3244052", "30779", "30780", "30781",
                          "30782", "30783", "30784", "30785", "30786", "30787", "30788", "30789", "30790", "30791",
                          "30792", "30793", "30794", "30795", "30796", "30797", "222502", "609802", "30798", "30799",
                          "30800", "696855", "1123007", "1480302", "1480303", "1480304", "2524352", "2554459",
                          "2554460", "2554461", "2554462", "2554463", "2554464", "2554465", "2617602", "2617603",
                          "2703452", "2710303", "2710304", "2710305", "2710313", "2710316", "2821452", "2821453",
                          "2821455", "2821456", "2852452", "2852453", "2879102", "2879103", "2879119", "2879120",
                          "2879121", "2879122", "2879123", "2879124", "2879125", "2879126", "2879128", "2879129",
                          "2879130", "3055552", "3055553", "3055554", "3055555", "3055556", "3055557", "3055558",
                          "3055559", "3055560", "3183452", "3210502", "3309404", "3342752", "3378502", "1936905",
                          "2218402", "2651352"]


def db_data(_app: str, _query: str, insert_data: list[dict] | None = None) -> dict | list[tuple]:
    try:
        if not insert_data:
            result = execute_query(
                _query,
                params.get(_app)
            )
        else:
            result = execute_query(
                _query,
                params.get(_app),
                insert_data
            )
        return result

    except Exception as e:
        print(e)
        return {}


def generate_vlglh_data() -> list[dict]:
    global vehicle_ids
    global today
    global prev_day

    lh_to_insert: list[dict] = []
    query: str = queries.get("fake_lh_data_insert")

    for vehicle in vehicle_ids:
        base_data: dict[str, Any] = {
            "bearing": 'NW',
            "timeZoneOffset": 2,
            "date": int(prev_day.replace(
                hour=random.randint(0, 23),
                minute=random.randint(0, 59),
                second=random.randint(0, 59)
            ).timestamp() * 1000),
            "eldSerialNum": f"87X050410120",
            "engineHours": 616.5,
            "fuel": 42,
            "geoCodedLocation": "6mi S of Traverse City, MI",
            "latitude": 44.673238,
            "longitude": -85.65682,
            "distance": 0,
            "odometer": 12300,
            "rpm": None,
            "speed": 0,
            "state": "US_MI_MICHIGAN",
            "totalFuelUsed": 49600,
            "type": "ON_PERIODIC",
            "uniqueId": 8388,
            "vin": "3ALACWFC6SDVZ8111",
            "vinRaw": "3ALACWFC6SDVZ8111",
            "vehicle_id": vehicle
        }

        lh_to_insert.append(base_data)

    print("Inserting location history data...")

    db_data("invoice", query, lh_to_insert)

    return lh_to_insert


def generate_sa_history_data() -> list[dict]:
    global vehicle_ids
    global today
    global prev_day

    sa_to_insert: list[dict] = []
    super_actions: list[str] = ["ADD_DVIR", "ADD_PTI", "ADD_TICK", "AI", "ANNOTATE_UD", "AVAILABLE_HOURS", "BULK_REASSIGN", "CANCEL_LOG_EDIT", "CERTIFY", "CONVERT_ANNOTATED_UD_TO_ACTIVE", "CONVERT_BLACK_TO_GREEN", "COPY_INTERMEDIATE", "CREATE_UD_FROM_LH", "DELETE_DVIR", "DELETE_OF_DEACTIVATED_EVENT", "DELETE_OF_GREEN_EVENT", "DELETE_OF_INTERMEDIATE_EVENT", "DELETE_OF_LH_RECORD", "DELETE_OF_TICK_EVENT", "DELETE_OF_UD", "EDIT_DVIR", "EDIT_LH", "EDIT_OF_INTERMEDIATE_EVENT", "EDIT_OF_TICK_EVENT", "EDIT_UD", "EDIT_UNCERTIFIED_LOG", "EXPAND", "FILL_IN", "FORCE_LOGOUT", "INSERT_EVENT", "LOGOUT", "REMOVE_ADVERSE", "SHRINK", "SLIDE", "SPLIT", "SUPER_EDIT", "SUPER_REASSIGN", "SUPER_UD_ASSIGN", "SWITCH", "UPDATE_DAILY_LOG", "UPDATE_DRIVER_EVENT_LOCATIONS", "UPDATE_DRIVER_INTERMEDIATE_EVENT_LOCATIONS", "UPDATE_DRIVER_TICK_EVENT_LOCATIONS", "UPDATE_LOG_EVENTS_LOCATIONS"]
    query: str = queries.get("fake_sa_history_insert")

    for vehicle in vehicle_ids:
        for i in range(2):
            base_data = {
                "action": random.choice(super_actions),
                "dateTime": int(
                    prev_day.replace(
                        hour=random.randint(0, 23),
                        minute=random.randint(0, 59),
                        second=random.randint(0, 59)
                    ).timestamp() * 1000
                ),
                "eventDate": 1747327989385,
                "toolsUser": "sashe@enterpriseeld.com",
                "driver_id": 6118,
                "superUser_id": None,
                "vehicle_id": vehicle,
            }
            sa_to_insert.append(base_data)

    print("Inserting super action history data...")

    db_data("invoice", query, sa_to_insert)

    return sa_to_insert


if __name__ == '__main__':
    lh = generate_vlglh_data()
    print(lh)
    print("Opa")
    sa = generate_sa_history_data()
    print(sa)
